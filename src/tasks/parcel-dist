#!/bin/bash
  
parcel_command="${1:-build}"
[ "$parcel_command" = "build" ] && base_path="$WEB_BASE_PATH"
[ -z "$base_path" ] && base_path="/"

npx task code-gen
npx task index-html-render-template
npx task index-html-gen

rm -rf "$DIST"
mkdir -p "$DIST"
cp -a "$STATIC/" "$DIST"

export BABEL_OMIT_PRESETS="@babel/preset-env | @babel/preset-react"

npx parcel "$parcel_command" \
    $PARCEL_OPTIONS \
    --public-url "$base_path" \
    --dist-dir "$DIST" \
    "${@:2}"
