#!/bin/bash
  
set -e

. $TASK_LIBRARY_SRC/load-task-vars

[ ! -f "$README_TEMPLATE" ] && exit 0

OPTIONS=()

if grep -q "@node-loader/babel" "./package.json"; then
    OPTIONS+=" --experimental-loader @node-loader/babel"
fi

node ${OPTIONS[@]} \
    "$TASK_LIBRARY_BIN/readme-gen.js" "$README_TEMPLATE" > "$README"

npx doctoc --maxlevel=2 "$README"

git add "$README"
